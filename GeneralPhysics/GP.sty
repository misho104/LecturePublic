% Time-Stamp: <2025-07-06 00:00:00>
\NeedsTeXFormat{LaTeX2e}[1999/12/01]
\ProvidesPackage{GP}
    [2025/07/06 v1.4 For 2025-1 lecture]
%   [2025/03/06 v1.3 For 2024-2 lecture]
%   [2024/02/21 v1.2 For 2023-2 lecture]
%   [2024/01/06 v1.1 End of 2023-1 lecture]
%   [2023/07/01 v1.0 Taken from 2022-2 lecture]

\newif\ifExamStyle\ExamStylefalse
\DeclareOption{ExamStyle}{\ExamStyletrue}
\ProcessOptions

\usepackage{circuitikz}
\usetikzlibrary{quotes,angles}
\usepackage{esvect}
\DeclareFontFamily{U}{esvect}{}
\DeclareFontShape{U}{esvect}{m}{n}{<-5.5>vect5<5.5-6.5>vect6<6.5-7.5>vect7<7.5-8.5>vect8<8.5-9.5>vect9<9.5->vect10}{}
\usepackage{multicol,tasks}
\NewDocumentEnvironment{menumerate}{O{}m+b}%
  {\begin{multicols}{#2}\begin{enumerate}[#1]#3\end{enumerate}\end{multicols}}\relax
\settasks{label-align=left,item-indent=2.5em,label-width=2.5em,label-offset=0pt}
\usepackage{pgfornament}
\newcommand\ornamentskip{\bigskip\begin{center}\pgfornament[width=7cm]{88}\end{center}\medskip}
\usepackage{lua-ul}


\def\@Alph#1{\ifcase#1%
    \or A\or B\or C\or D\or E\or F\or G\or H\or I\or J\or K\or L\or M%
    \or N\or O\or P\or Q\or R\or S\or T\or U\or V\or W\or X\or Y\or Z%
    \or AA\or BB\or CC\or DD\or EE\or FF\or GG\or HH\or II\or JJ\or KK\or LL\or MM%
    \or NN\or OO\or PP\or QQ\or RR\or SS\or TT\or UU\or VV\or WW\or XX\or YY\or ZZ \else\@ctrerr\fi
}
\def\Heavenly#1{\expandafter\@Heavenly\csname c@#1\endcsname}
\newcommand*{\@Heavenly}[1]{%
  \begin{japanese}\ifcase#1\or 甲\or 乙\or 丙\or 丁\or 戊\or 己\or 庚\or 辛\or 壬\or 癸\else\@ctrerr\fi\end{japanese}%
}
\AddEnumerateCounter\Heavenly\@Heavenly{M}

\def\DefineWeekdays#1{\directlua{define_next_days(#1)}}
\begin{luacode*}
  function to_md (date)
    tmp = os.date("{%b.~%d}", date)
    tmp = tmp:sub(7, 7) == "0" and tmp:sub(1, 6) .. tmp:sub(8, 9) or tmp
    return tmp:sub(2, 4) == "May" and tmp:gsub("%.", "") or tmp
  end
  function to_ymd (date)
    tmp = os.date("{%b.~%d, %Y}", date)
    tmp = tmp:sub(7, 7) == "0" and tmp:sub(1, 6) .. tmp:sub(8, 15) or tmp
    return tmp:sub(2, 4) == "May" and tmp:gsub("%.", "") or tmp
  end
  function define_next_days (date)
    yy = string.sub(date, 1, 4)
    mm = string.sub(date, 5, 6)
    dd = string.sub(date, 7, 8)
    origin = os.time{year=yy, month=mm, day=dd, hour=12}
    origin_dow = os.date("%w", origin)
    print("\nDefine dates based on " .. to_md(origin))
    tex.sprint("\\def\\OriginDay" .. to_md(origin))
    tex.sprint("\\def\\OriginDayYMD" .. to_ymd(origin))
    for i = 1, 7 do
      dow = tostring(math.floor((origin_dow + i) % 7 + 0.1))
      tex.sprint("\\expandafter\\def\\csname NextDay" .. dow .. "\\endcsname" .. to_md(origin + 86400 * i))
    end
  end
\end{luacode*}
\newcommand\NextMonday[1][next Monday]{#1 (\RED{\@nameuse{NextDay1}})\xspace}
\newcommand\NextTuesday[1][next Tuesday]{#1 (\RED{\@nameuse{NextDay2}})\xspace}
\newcommand\NextWednesday[1][next Wednesday]{#1 (\RED{\@nameuse{NextDay3}})\xspace}

% units
\newcommand*{\ohm}{\unit{\Omega}}
\newcommand*{\volt}{\unit{V}}
\newcommand*{\ampere}{\unit{A}}
\newcommand*{\meter}{\unit{m}}
\newcommand*{\second}{\unit{s}}
\newcommand*{\newton}{\unit{N}}

\newcommand*{\kg}{\unit{kg}}
\newcommand*{\mm}{\unit{mm}}
\newcommand*{\cm}{\unit{cm}}
\newcommand*{\Hz}{\unit{Hz}}

\newcommand*{\mps}{\unit{m/s}}
\newcommand*{\mpss}{\unit{m/s^2}}

\newcommand*{\nC}{\unit{nC}}
\newcommand*{\muC}{\unit{\mu C}}
\newcommand*{\muF}{\unit{\mu F}}

% vector: use arrow
\def\vc#1{\@ifnextchar_{\@vc@two{#1}}{\@vc@one{#1}}}
\def\@vc@one#1{\vv{#1}}
\def\@vc@two#1_#2{\vv*{#1}{#2}}
\newcommand*{\point}[1]{\mathrm{#1}}     % point A
\newcommand*{\vvv}[1]{\vv{\mathrm{#1}}}  % vector AB
\newcommand*{\posvec}[2]{{\mathrm{#1}}(\vc #2)} % position vector A(a)
\newcommand*{\plen}[1]{\overline{\mathrm{#1}}}
\newcommand*{\pangle}[1]{\angle{\mathrm{#1}}}

\newcommand*{\vvex}{\vc{e_x}}
\newcommand*{\vvey}{\vc{e_y}}
\newcommand*{\vvez}{\vc{e_z}}
\newcommand*{\vvev}[1]{\vv{e}_{\vvv{#1}}}

\newcommand*{\vgrad}{\@ifstar{\mathord{\nabla}}{\qopname\relax o{grad}}}
\newcommand*{\vdiv}{\@ifstar{\mathord{\nabla}\mathop{\cdot}}{\qopname\relax o{div}}}
\newcommand*{\vrot}{\@ifstar{\mathord{\nabla}\mathop{\times}}{\qopname\relax o{rot}}}

% sheet env
\newcommand*\Hint[2][Hint:~]{\textsf{[#1#2]}}
\newcommand*\TailHint[1]{\textit{\sffamily[#1]}}
\newcommand*{\score}[1]{{$\mathsf{(#1)}$\,}}

\newcommand\GrayBox[2][0em]{\kern#1\fcolorbox{black}{lightgray}{\phantom{#2}}\kern#1}
\newcommand\fakebullet{\makebox[2.5em][r]{\textbullet\kern.5em}}

\newcommand\Myparbox[2][0.83\textwidth]{\begin{center}\setlength{\fboxrule}{2.0pt}\fbox{\parbox{#1}{#2}}\end{center}}
\newcommand*\Maru[2][\relax]{\tikz[baseline=-3.5,scale=0.9,transform shape]{%
  \node[draw,circle,inner sep=0pt,anchor=center] (char) at (0,0){\rule[0mm]{0mm}{1.15em}};%
  \node[anchor=center,inner sep=0mm] at (0,0){{#1#2}\rule[-0.3em]{0mm}{1.18em}}}%
}

\newcommand*\Item[1]{\stepcounter{\@enumctr}\item[{#1\csname label\@enumctr\endcsname}]}
\newcommand*\itemS{\Item{\GS}}
\newcommand*\itemA{\Item{\GA}}
\newcommand*\itemB{\Item{\GB}}
\newcommand*\itemC{\Item{\GC}}
\newcommand\GS{$\bigstar$}
\newcommand\GA{$^{***}$}
\newcommand\GB{$^{**}$}
\newcommand\GC{$^{*}$}

% MishoNote default: i. ii. iii. (a) (b) (c) 1. 2. 3. A. B. C.
\def\SetLevels#1#2#3{%
  \expandafter\let\expandafter\LvA\csname @#1\endcsname
  \expandafter\let\expandafter\LvB\csname @#2\endcsname
  \expandafter\let\expandafter\LvC\csname @#3\endcsname}
\SetLevels{Alph}{arabic}{alph}

\newcommand*\QPart[1]{\textbfsf{[#1]}}
\newcommand*\QSub[1]{\textbfsf{(#1)}}
\renewcommand\theenumi{\noexpand\LvA\c@enumi}
\renewcommand\theenumii{\noexpand\LvB\c@enumii}
\renewcommand\labelenumi{\QPart{\theenumi}}
\renewcommand\labelenumii{\QSub{\theenumii}~~~}
\newcommand\labelblank[1]{\QSub{\LvC{#1}}}
\newcounter{blank}
\def\BLANK{\@ifnextchar({\BLANK@setlen}{\BLANK@default}}
\def\BLANK@setlen(#1){\def\BLANK@@spacing{#1}\@ifnextchar[{\BLANK@spc}{\BLANK@def}}
\def\BLANK@default{\BLANK@setlen(0.8em)}
\def\BLANK@def{\stepcounter{blank}\BLANK@spc[\theblank]}
\def\BLANK@spc[#1]{\setlength{\fboxsep}{0pt}\fbox{\rule[-.25em]{0pt}{1.1em}\kern\BLANK@@spacing{\labelblank{#1}}\kern\BLANK@@spacing}\xspace}

\providecommand\PreCounterLabel{\thesection}
\def\thetcb@cnt@theorem{\PreCounterLabel.\arabic{tcb@cnt@theorem}}
\def\thetcb@cnt@definition{\PreCounterLabel.\arabic{tcb@cnt@theorem}}
\def\thetcb@cnt@claim{\PreCounterLabel.\arabic{tcb@cnt@theorem}}
\def\theequation{\PreCounterLabel.\arabic{equation}}

\ifdefined\begin@@problems
  \def\begin@@problems{\begin{enumerate}[problems@property,label={\noexpand\MaybeLevel\QPart{\Alph*}},ref={\QPart{\Alph*}}]}
  \def\begin@@quizzes {\begin{enumerate}[quizzes@property, label={\noexpand\MaybeLevel\QPart{\Alph*}},ref={\QPart{\Alph*}}]}
  \RenewDocumentCommand\new@problem{m}{\gdef\MaybeLevel{\IfValueTF{#1}{\csname G#1\endcsname}{\relax}}\relax\item}
  \RenewDocumentCommand\Quiz{o}{\new@problem{#1}}
  \RenewDocumentCommand\Problem{o}{\new@problem{#1}}
\fi

\ifExamStyle
  % promote subsection -> section, etc.
  \renewcommand\section{\@startsection{section}{1}{\z@}{-3.25ex\@plus -1ex \@minus -.2ex}{1.5ex \@plus .2ex}{\headfont\large\bfseries}}
  \renewcommand\subsection{\@startsection{subsection}{2}{\z@}{-3.25ex\@plus -1ex \@minus -.2ex}{1.5ex \@plus .2ex}{\headfont\normalsize\bfseries}}
  %
  \renewcommand\QPart[1]{\styleproblem{[Part~#1]}}
  \renewcommand\thesection{\QPart{\LvA\c@section}}
  \def\labelenumi{\QSub{\theenumi}}
  \def\theenumi{\noexpand\LvB\c@enumi}
  \def\labelenumii{\styleproblem{\theenumii)~~~}}
  \def\theenumii{\noexpand\LvC\c@enumii}
  %
  \newcommand\ExamPart[2]{\section[#1]{#1~\score{#2}\xspace}}
  \SetHead{p}{\thepage/\NoHyper\pageref{LastPage}\endNoHyper}
  \renewcommand\theequation{\@arabic\c@equation}
\fi

\endinput
